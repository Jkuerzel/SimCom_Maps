
<div>
  <div>
    <h1>
      <%= @the_map.name %> - details
    </h1>
  </div>
</div>

<hr>

 
<div style="display: flex; flex-wrap: wrap; align-content: flex-start;">

  <% @map_buildings_by_position = @the_map.map_buildings.index_by(&:position_id) %>
  
  <% for @the_position_id in 1..14 %>
    <% @the_building = @map_buildings_by_position[@the_position_id] %>

    <!-- Building or Placeholder -->
    <% if @the_building %>

      <%= render 'maps/changebuildingtype', 
      the_position_id: @the_position_id, 
      the_map: @the_map, 
      the_building: @the_building %>

      <div style="display: flex; align-content: space-between; padding: 0px; height: 120px; width: 120px;">
        <div class="image-container" style="position: relative; width: 120px; height: 120px; padding: 0px;">
          <!-- First Image (Background) -->
          <img src="<%= @the_building.building_type.image_link %>" 
              alt="Open Modal" 
              style="cursor: pointer; width: 120%; height: 120%; object-fit: cover;" 
              data-bs-toggle="modal" 
              data-bs-target="#buildingtypemodal<%= @the_position_id %>">

          <!-- Second Image (Foreground, Bottom Right) -->
          <img src="<%= @the_building.product.image_link %>" 
              alt="Product" 
              style="position: absolute; bottom: 0; right: 0; width: 50px; height: 50px; object-fit: contain; z-index: 1;">
        </div>
      </div>

    <% else %>

      <%= render 'maps/choosebuildingtype', 
      the_position_id: @the_position_id, 
      the_map: @the_map, 
      the_building: @the_building %>

      <div style="display: flex; align-content: space-between; height: 120px; width:120px;">
        <img src="https://www.drupal.org/files/styles/grid-2-2x-square/public/user-pictures/picture-260224-1684978762.png?itok=bOyj5wuB" 
             alt="Open Modal" 
             style="cursor: pointer; width: auto; height: auto;" 
             data-bs-toggle="modal" 
             data-bs-target="#buildingtypemodal<%= @the_position_id %>">
      </div>
    <% end %>
  <% end %>

</div>

<hr>

<div style="display: flex";>
  <div style="padding: 5px">
    <!-- Trigger Button -->
    <button type="button" class="btn" 
        style="border: 1px solid #0d1432; color: #0d1432; background-color: #e0e2e9;" 
        data-bs-toggle="modal" 
        data-bs-target="#income_statement_modal">
      Income statement
    </button>

    <%= render 'maps/income_statement', 
      the_position_id: @the_position_id, 
      the_map: @the_map, 
      the_building: @the_building %>

  </div>

  <div style="padding: 5px">

    <%= render 'maps/flow_of_goods', 
      the_position_id: @the_position_id, 
      the_map: @the_map, 
      the_building: @the_building %>

    <button type="button" class="btn" 
        style="border: 1px solid #0d1432; color: #0d1432; background-color: #e0e2e9;" 
        data-bs-toggle="modal" 
        data-bs-target="#production_modal">
      Flow of goods
    </button>

  </div>
</div>

<hr>

<%if @the_map.owner_id==current_user.id%>
  <div>
    <div>
      <h2>
        Edit map
      </h2>

      <form action="/modify_map/<%= @the_map.id %>"  method="post" >
      <div>
          <label for="name_box">
            Name
          </label>

          <input type="text" id="name_box" name="query_name" value="<%= @the_map.name %>">
        </div>

        <button>
          Update map
        </button>
      </form>
    </div>
  </div>

  <hr>

  <div>
    <div>
      
    </div>
  </div>
<%end%>

<div>
<dl>
    <dt>
      Owner
    </dt>
    <dd>
      <%= @the_map.owner.email %>
    </dd>

    <dt>
      Created at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_map.created_at) %> ago
    </dd>

    <dt>
      Updated at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_map.updated_at) %> ago
    </dd>
  </dl>
</div>
