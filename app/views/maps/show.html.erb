<div>
  <div>
    <h1>
      <%= @the_map.name %> - details
    </h1>
  </div>
</div>


<%@ledger=@the_map.production%>
<table style="border-collapse: collapse; width: 100%; text-align: left;">
  <thead>
    <tr>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Resource</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Quality</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Produced</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Consumed</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Excess</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Purchased</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Price</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Fee paid</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Transport Units</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Transport Cost</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Wage Cost Workers</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Wage Cost Admin</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Cost of Purchased Goods</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Revenue</th>
    </tr>
  </thead>
  <tbody>
    <% @ledger.each do |resource_id, qualities| %>
      <% qualities.each do |quality, flow| %>
        <tr>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= resource_id %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= quality %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:produced].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:consumed].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:excess].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:purchased].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:price].round(2) %> $</td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:fee_paid].round(2) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:transport_needed].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:transport_cost].round(2) %> $</td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:wage_cost].round(2) %> $</td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:administration_wages].round(2) %> $</td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:cost_of_goods_purchased].round(2) %> $</td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:revenue].round(2) %> $</td>
          
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>


<hr>
<div style="display: flex; flex-wrap:wrap; align-content:flex-start;">
  <% for the_position_id in 1..18 %>
  <% the_building = @the_map.map_buildings.find_by(position_id: the_position_id) %>
  <div class="image-container">
    <% if the_building %>
      <a href="/map_buildings/<%= the_building.id %>">
        <img src="<%= the_building.building_type.image_link %>" alt="Building on the map" style="width: 100px; height: 100px;">
      </a>
    <% else %>
      <a href="/maps/<%= @the_map.id %>/new_building/<%= the_position_id %>">
        <img src="https://media.istockphoto.com/id/688550958/vector/black-plus-sign-positive-symbol.jpg?s=612x612&w=0&k=20&c=0tymWBTSEqsnYYXWeWmJPxMotTGUwaGMGs6BMJvr7X4=" alt="Add new building" style="width: 100px; height: 100px;">
      </a>
    <% end %>
  </div>
<% end %>
</div>
<hr>


<%if @the_map.owner_id==current_user.id%>
  <div>
    <div>
      <h2>
        Edit map
      </h2>

      <form action="/modify_map/<%= @the_map.id %>"  method="post" >
      <div>
          <label for="name_box">
            Name
          </label>

          <input type="text" id="name_box" name="query_name" value="<%= @the_map.name %>">
        </div>

        <button>
          Update map
        </button>
      </form>
    </div>
  </div>

  <hr>

  <div>
    <div>
      
    </div>
  </div>
<%end%>

<div>
<dl>
    <dt>
      Owner
    </dt>
    <dd>
      <%= @the_map.owner.email %>
    </dd>

    <dt>
      Created at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_map.created_at) %> ago
    </dd>

    <dt>
      Updated at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_map.updated_at) %> ago
    </dd>
  </dl>
</div>
    <div>
      <div>
        <a href="/maps">
          Go back
        </a>
      </div>
      <%if @the_map.owner_id==current_user.id%>
      <div>
        <a href="/delete_map/<%= @the_map.id %>">
          Delete map
        </a>
      </div>
      <%end%>
    </div>


<h1><%=@the_map.total_profit.round(0)%> $</h1>

-
<!--

Revenue
Cost of Goods Sold
Sold Products
fees paid
transport cost

-->
