<div>
  <div>
    <h1>
      <%= @the_map.name %> - details
    </h1>
  </div>
</div>

<hr>


<div style="padding: 0 100px;"> <!-- Padding links und rechts -->
  <h2>Income Statement</h2>
  <table style="border-collapse: collapse; width: 100%; text-align: left; font-family: Arial, sans-serif;">
    <thead>
      <tr style="background-color: #f4f4f4;">
        <th style="padding: 8px; border-bottom: 2px solid #ddd;">Metric</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: right;">Value</th>
      </tr>
    </thead>
    <tbody>
      <!-- Revenue Section -->
      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; font-weight: bold;">Total Revenue</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%= @income_statement[:total_revenue].round %> $</td>
      </tr>

      <!-- COGS Section -->
      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd;">Cost of Purchased Goods</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%= @income_statement[:total_cost_of_purchased_goods].round %> $</td>
      </tr>
      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd;">Worker Wages</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%= @income_statement[:total_worker_wages].round %> $</td>
      </tr>
      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; font-weight: bold;">Cost of Goods Sold (COGS)</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right; font-weight: bold;"><%= @income_statement[:cogs].round %> $</td>
      </tr>

      <!-- Freight Out Section -->

      <!-- Gross Income Section -->
      <tr style="background-color: #e8f4e8;">
        <td style="padding: 8px; border-bottom: 2px solid #ddd; font-weight: bold;">Gross Income</td>
        <td style="padding: 8px; border-bottom: 2px solid #ddd; text-align: right; font-weight: bold;"><%= @income_statement[:gross_income].round %> $</td>
      </tr>

      <!-- Operating Expenses Section -->
      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd;">Admin Overhead Wages</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%= @income_statement[:total_admin_overhead_wages].round %> $</td>
      </tr>
      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd;">Executive Salaries</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%= @income_statement[:executives_salaries].round %> $</td>
      </tr>
      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd;">Total Fees Paid</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%= @income_statement[:total_fees_paid].round %> $</td>
      </tr>

      <tr>
        <td style="padding: 8px; border-bottom: 1px solid #ddd;">Freight Out</td>
        <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><%= @income_statement[:freight_out].round %> $</td>
      </tr>

      <!-- Operating Income Section -->
      <tr style="background-color: #e8f4e8;">
        <td style="padding: 8px; border-bottom: 2px solid #ddd; font-weight: bold;">Operating Income</td>
        <td style="padding: 8px; border-bottom: 2px solid #ddd; text-align: right; font-weight: bold;"><%= @income_statement[:operating_income].round %> $</td>
      </tr>
    </tbody>
  </table>
</div>


<hr>
<div style="display: flex; flex-wrap:wrap; align-content:flex-start;">
  <% for the_position_id in 1..18 %>
  <% the_building = @the_map.map_buildings.find_by(position_id: the_position_id) %>
  <div class="image-container">
    <% if the_building %>
      <a href="/map_buildings/<%= the_building.id %>">
        <img src="<%= the_building.building_type.image_link %>" alt="Building on the map" style="width: 100px; height: 100px;">
      </a>
    <% else %>
      <a href="/maps/<%= @the_map.id %>/new_building/<%= the_position_id %>">
        <img src="https://media.istockphoto.com/id/688550958/vector/black-plus-sign-positive-symbol.jpg?s=612x612&w=0&k=20&c=0tymWBTSEqsnYYXWeWmJPxMotTGUwaGMGs6BMJvr7X4=" alt="Add new building" style="width: 100px; height: 100px;">
      </a>
    <% end %>
  </div>
<% end %>
</div>
<hr>

<table style="border-collapse: collapse; width: 100%; text-align: left;">
  <thead>
    <tr>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Resource</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Quality</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Produced</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Consumed</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Excess</th>
      <th style="padding: 8px; border-bottom: 1px solid #ddd;">Purchased</th>

    </tr>
  </thead>
  <tbody>
    <% totals = { produced: 0, consumed: 0, excess: 0, purchased: 0, fee_paid: 0, transport_cost: 0, wage_cost: 0, administration_wages: 0, cost_of_goods_purchased: 0, revenue: 0, income_impact: 0 } %>
    <% @ledger.each do |resource_id, qualities| %>
      <% qualities.each do |quality, flow| %>
        <tr>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= resource_id %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= quality %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:produced].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:consumed].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:excess].round(0) %></td>
          <td style="padding: 8px; border-bottom: 1px solid #ddd;"><%= flow[:purchased].round(0) %></td>
        </tr>
        <% # Update totals %>
        <% totals[:produced] += flow[:produced] %>
        <% totals[:consumed] += flow[:consumed] %>
        <% totals[:excess] += flow[:excess] %>
        <% totals[:purchased] += flow[:purchased] %>

      <% end %>
    <% end %>
    <tr style="font-weight: bold; background-color: #f4f4f4;">
      <td colspan="2" style="padding: 8px; border-top: 2px solid #000;">Totals</td>
      <td style="padding: 8px; border-top: 2px solid #000;"><%= totals[:produced].round(0) %></td>
      <td style="padding: 8px; border-top: 2px solid #000;"><%= totals[:consumed].round(0) %></td>
      <td style="padding: 8px; border-top: 2px solid #000;"><%= totals[:excess].round(0) %></td>
      <td style="padding: 8px; border-top: 2px solid #000;"><%= totals[:purchased].round(0) %></td>

    </tr>
  </tbody>
</table>

<hr>

<%if @the_map.owner_id==current_user.id%>
  <div>
    <div>
      <h2>
        Edit map
      </h2>

      <form action="/modify_map/<%= @the_map.id %>"  method="post" >
      <div>
          <label for="name_box">
            Name
          </label>

          <input type="text" id="name_box" name="query_name" value="<%= @the_map.name %>">
        </div>

        <button>
          Update map
        </button>
      </form>
    </div>
  </div>

  <hr>

  <div>
    <div>
      
    </div>
  </div>
<%end%>

<div>
<dl>
    <dt>
      Owner
    </dt>
    <dd>
      <%= @the_map.owner.email %>
    </dd>

    <dt>
      Created at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_map.created_at) %> ago
    </dd>

    <dt>
      Updated at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_map.updated_at) %> ago
    </dd>
  </dl>
</div>
    <div>
      <div>
        <a href="/maps">
          Go back
        </a>
      </div>
      <%if @the_map.owner_id==current_user.id%>
      <div>
        <a href="/delete_map/<%= @the_map.id %>">
          Delete map
        </a>
      </div>
      <%end%>
    </div>


<h1><%=@the_map.total_profit.round(0)%> $</h1>

-
<!--

Revenue
Cost of Goods Sold
Sold Products
fees paid
transport cost

-->
